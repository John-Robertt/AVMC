# ADR 0003：HTTP 代理池策略（每请求新连接 + UA 内置 + 图片代理开关）

## 状态
已接受

## 背景
JavBus/JavDB 存在访问限制。用户已验证可通过“HTTP 代理池 + UA 池 + 并发”提高可用性。关键约束是：代理池后端依赖“每个请求新建代理连接”，若复用 keep-alive 会导致无法轮换。

同时，图片下载是否走代理需要可控：默认直连以减少代理压力，必要时可开启。

## 决策
1) UA 池大量内置于工具内：每个请求随机选择 UA，不对外暴露配置
2) proxy.url 指向一个 HTTP 代理入口（后端是代理池）
3) 启用代理时，HTTP 必须满足：
   - 禁用 keep-alive（每请求新建连接）
   - 有界重试与超时（避免无限挂死）
4) 图片下载受 `image_proxy` 控制：
   - 默认 `false`：图片直连
   - `true`：图片也走 proxy.url

## 后果（Trade-offs）
- 优点：代理池轮换可生效；行为简单可预测；图片代理可按需开启。
- 缺点：禁用 keep-alive 会增加连接开销；但站点可用性优先于微小性能。

